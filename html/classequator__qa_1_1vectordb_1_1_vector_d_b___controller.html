<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EQUATOR: equator_qa.vectordb.VectorDB_Controller Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EQUATOR
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classequator__qa_1_1vectordb_1_1_vector_d_b___controller.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classequator__qa_1_1vectordb_1_1_vector_d_b___controller-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">equator_qa.vectordb.VectorDB_Controller Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for equator_qa.vectordb.VectorDB_Controller:</div>
<div class="dyncontent">
<div class="center"><img src="classequator__qa_1_1vectordb_1_1_vector_d_b___controller__inherit__graph.png" border="0" usemap="#aequator__qa_8vectordb_8_vector_d_b___controller_inherit__map" alt="Inheritance graph"/></div>
<map name="aequator__qa_8vectordb_8_vector_d_b___controller_inherit__map" id="aequator__qa_8vectordb_8_vector_d_b___controller_inherit__map">
<area shape="rect" title=" " alt="" coords="5,80,185,123"/>
<area shape="rect" title=" " alt="" coords="67,5,123,32"/>
<area shape="poly" title=" " alt="" coords="98,48,98,80,92,80,92,48"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for equator_qa.vectordb.VectorDB_Controller:</div>
<div class="dyncontent">
<div class="center"><img src="classequator__qa_1_1vectordb_1_1_vector_d_b___controller__coll__graph.png" border="0" usemap="#aequator__qa_8vectordb_8_vector_d_b___controller_coll__map" alt="Collaboration graph"/></div>
<map name="aequator__qa_8vectordb_8_vector_d_b___controller_coll__map" id="aequator__qa_8vectordb_8_vector_d_b___controller_coll__map">
<area shape="rect" title=" " alt="" coords="5,80,185,123"/>
<area shape="rect" title=" " alt="" coords="67,5,123,32"/>
<area shape="poly" title=" " alt="" coords="98,48,98,80,92,80,92,48"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a75f1019ca1e81aa65d74ad1c57057d0e" id="r_a75f1019ca1e81aa65d74ad1c57057d0e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a75f1019ca1e81aa65d74ad1c57057d0e">__init__</a> (self, <a class="el" href="#a445fe5029b1ab0bf0e7c31921ea5f7f1">keepVectorDB</a>, VISION)</td></tr>
<tr class="separator:a75f1019ca1e81aa65d74ad1c57057d0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20c0cb4766eadf468b69b730095c2053" id="r_a20c0cb4766eadf468b69b730095c2053"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a20c0cb4766eadf468b69b730095c2053">generate_embeddings</a> (self, model, input_text, truncate=True)</td></tr>
<tr class="separator:a20c0cb4766eadf468b69b730095c2053"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e99eb967400dffb2292f302e2ee9d10" id="r_a5e99eb967400dffb2292f302e2ee9d10"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5e99eb967400dffb2292f302e2ee9d10">retrieve_embedding</a> (self, prompt, n_results=1)</td></tr>
<tr class="separator:a5e99eb967400dffb2292f302e2ee9d10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad13d2228589a87d3ab4c52ef133507b3" id="r_ad13d2228589a87d3ab4c52ef133507b3"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad13d2228589a87d3ab4c52ef133507b3">retrieve_embedding_vision</a> (self, prompt, n_results=1)</td></tr>
<tr class="separator:ad13d2228589a87d3ab4c52ef133507b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3ddbbca85c7664bb56567221fe5805f" id="r_aa3ddbbca85c7664bb56567221fe5805f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa3ddbbca85c7664bb56567221fe5805f">add_to_vector_db</a> (self, vector_db, entry_id, serialized_conversations, metadata)</td></tr>
<tr class="separator:aa3ddbbca85c7664bb56567221fe5805f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9ecebea5cbed0c54a33acb42a1999d27" id="r_a9ecebea5cbed0c54a33acb42a1999d27"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9ecebea5cbed0c54a33acb42a1999d27">create_vector_db</a> (self, conversations)</td></tr>
<tr class="separator:a9ecebea5cbed0c54a33acb42a1999d27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a862a0f5f808ef8718cbd4e067a263beb" id="r_a862a0f5f808ef8718cbd4e067a263beb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a862a0f5f808ef8718cbd4e067a263beb">convert_metadata_value</a> (self, value)</td></tr>
<tr class="separator:a862a0f5f808ef8718cbd4e067a263beb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39e48d77a583ccef6a9842de2b038c4e" id="r_a39e48d77a583ccef6a9842de2b038c4e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a39e48d77a583ccef6a9842de2b038c4e">flatten_embedding</a> (self, embedding)</td></tr>
<tr class="separator:a39e48d77a583ccef6a9842de2b038c4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3ddbbca85c7664bb56567221fe5805f" id="r_aa3ddbbca85c7664bb56567221fe5805f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa3ddbbca85c7664bb56567221fe5805f">add_to_vector_db</a> (self, vector_db, entry_id, serialized_conversations, metadata)</td></tr>
<tr class="separator:aa3ddbbca85c7664bb56567221fe5805f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:abd453000e0c3c3079b7b6b7e50a5d711" id="r_abd453000e0c3c3079b7b6b7e50a5d711"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abd453000e0c3c3079b7b6b7e50a5d711">base_url</a> = &quot;http://localhost:11434&quot;</td></tr>
<tr class="separator:abd453000e0c3c3079b7b6b7e50a5d711"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3bb137ff4503408f32c64ee39dfbfd16" id="r_a3bb137ff4503408f32c64ee39dfbfd16"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3bb137ff4503408f32c64ee39dfbfd16">chroma_client</a> = chromadb.PersistentClient(path=&quot;.&quot;)</td></tr>
<tr class="separator:a3bb137ff4503408f32c64ee39dfbfd16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a445fe5029b1ab0bf0e7c31921ea5f7f1" id="r_a445fe5029b1ab0bf0e7c31921ea5f7f1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a445fe5029b1ab0bf0e7c31921ea5f7f1">keepVectorDB</a> = keepVectorDB</td></tr>
<tr class="separator:a445fe5029b1ab0bf0e7c31921ea5f7f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a75f1019ca1e81aa65d74ad1c57057d0e" name="a75f1019ca1e81aa65d74ad1c57057d0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75f1019ca1e81aa65d74ad1c57057d0e">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>keepVectorDB</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>VISION</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Initialize the VectorDB_Controller class.

Parameters:
keepVectorDB (bool): A flag indicating whether to keep the VectorDB or not.

Attributes:
base_url (str): The base URL for the VectorDB service.
chroma_client (chromadb.PersistentClient): The Chroma client for interacting with the VectorDB.
keepVectorDB (bool): A flag indicating whether to keep the VectorDB or not.

If keepVectorDB is False, the function will open the "linguistic_benchmark.json" file,
parse the data, and create a VectorDB using the parsed conversations.
</pre> 
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aa3ddbbca85c7664bb56567221fe5805f" name="aa3ddbbca85c7664bb56567221fe5805f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3ddbbca85c7664bb56567221fe5805f">&#9670;&#160;</a></span>add_to_vector_db() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.add_to_vector_db </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>vector_db</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>entry_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>serialized_conversations</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>metadata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Adds a conversation entry to the specified vector database with its corresponding embeddings and metadata.

This method performs the following steps:
1. Generates embeddings for the provided serialized conversations using the "all-minilm" model.
2. Flattens the embeddings if they are nested.
3. Converts metadata values to appropriate formats.
4. Adds the entry, including its ID, embeddings, serialized conversations, and metadata, to the vector database.

If embedding generation fails or the entry cannot be added to the vector database, the method logs an error message.

Args:
    vector_db (VectorDatabase):
        An instance of the vector database where the entry will be stored. 
        This database should support the `add` method with parameters `ids`, `embeddings`, `documents`, and `metadatas`.
    
    entry_id (Union[str, int]):
        A unique identifier for the entry being added to the vector database. 
        This ID is used to reference the entry in future operations.
    
    serialized_conversations (str):
        The serialized conversation data to be embedded and stored. 
        This should be a string representation of the conversation, suitable for embedding generation.
    
    metadata (Dict[str, Any]):
        A dictionary containing metadata associated with the conversation. 
        Metadata values will be converted to appropriate formats before being stored.

Returns:
    None

Raises:
    None. All exceptions are handled internally and logged as error messages.

Example:
    ```python
    vector_db = VectorDatabase(...)
    entry_id = 12345
    serialized_conversations = "User: Hello\nBot: Hi there!"
    metadata = {
        "user_id": 67890,
        "timestamp": "2025-01-19T12:34:56Z",
        "conversation_length": 2
    }
    instance.add_to_vector_db(vector_db, entry_id, serialized_conversations, metadata)
    ```

Notes:
    - The embedding generation uses the "all-minilm" model. Ensure that this model is supported and properly configured.
    - The `flatten_embedding` method is used to handle nested embeddings, ensuring they are in a suitable format for the vector database.
    - Metadata conversion is handled by the `convert_metadata_value` method, which should appropriately transform each metadata value.
    - Errors during embedding generation or database insertion do not raise exceptions but are logged for debugging purposes.
    - Ensure that the `vector_db` instance is properly initialized and connected before calling this method.
</pre> 
</div>
</div>
<a id="aa3ddbbca85c7664bb56567221fe5805f" name="aa3ddbbca85c7664bb56567221fe5805f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3ddbbca85c7664bb56567221fe5805f">&#9670;&#160;</a></span>add_to_vector_db() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.add_to_vector_db </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>vector_db</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>entry_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>serialized_conversations</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>metadata</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Adds a conversation entry to the specified vector database with its corresponding embeddings and metadata.

This method performs the following steps:
1. Generates embeddings for the provided serialized conversations using the "all-minilm" model.
2. Validates the response to ensure embeddings are retrieved successfully.
3. Flattens the embeddings if they are nested to ensure compatibility with the vector database.
4. Converts metadata values to appropriate formats suitable for storage.
5. Adds the entry, including its ID, embeddings, serialized conversations, and metadata, to the vector database.

If embedding generation fails or the entry cannot be added to the vector database, the method logs an error message.

Args:
    vector_db (VectorDatabase):
        An instance of the vector database where the entry will be stored. 
        This database should support the `add` method with parameters `ids`, `embeddings`, `documents`, and `metadatas`.
    
    entry_id (Union[str, int]):
        A unique identifier for the entry being added to the vector database. 
        This ID is used to reference the entry in future operations.
    
    serialized_conversations (str):
        The serialized conversation data to be embedded and stored. 
        This should be a string representation of the conversation, suitable for embedding generation.
    
    metadata (Dict[str, Any]):
        A dictionary containing metadata associated with the conversation. 
        Metadata values will be converted to appropriate formats before being stored.

Returns:
    None

Raises:
    None. All exceptions are handled internally and logged as error messages.

Example:
    ```python
    # Assuming `instance` is an instance of the class containing this method
    vector_db = VectorDatabase(...)
    entry_id = 12345
    serialized_conversations = "User: Hello\nBot: Hi there!"
    metadata = {
        "user_id": 67890,
        "timestamp": "2025-01-19T12:34:56Z",
        "conversation_length": 2
    }
    instance.add_to_vector_db(vector_db, entry_id, serialized_conversations, metadata)
    ```

Notes:
    - **Embedding Generation**: The method uses the "all-minilm" model for generating embeddings. Ensure that this model is supported, properly configured, and that the necessary dependencies are installed.
    - **Flattening Embeddings**: The `flatten_embedding` method is used to handle nested embeddings, ensuring they are in a suitable format for the vector database. It's crucial that the embeddings are correctly flattened to maintain their integrity and usefulness.
    - **Metadata Conversion**: Metadata conversion is handled by the `convert_metadata_value` method, which transforms each metadata value into a JSON-serializable format if necessary. Ensure that this method is correctly implemented to handle various data types.
    - **Error Handling**: 
        - If embedding generation fails (e.g., due to an unsupported model or invalid input), an error is logged, and the method exits without adding the entry to the database.
        - If adding the entry to the vector database fails (e.g., due to connectivity issues or invalid data), an error is logged with details of the exception.
    - **Vector Database Requirements**: The `vector_db` instance must be properly initialized, connected, and configured to accept entries with the specified parameters (`ids`, `embeddings`, `documents`, `metadatas`). Ensure that the vector database schema aligns with the data being inserted.
    - **Data Integrity**: 
        - The `entry_id` should be unique to prevent collisions or overwrites in the vector database.
        - The `serialized_conversations` should accurately represent the conversation to ensure meaningful embeddings and retrieval.
    - **Logging**: The method relies on a configured `logger` to record error messages. Ensure that the logging system is set up appropriately to capture and store these logs for debugging and monitoring purposes.
    - **Performance Considerations**: 
        - Batch processing of multiple entries might improve performance if supported by the vector database.
        - Consider implementing retry mechanisms for transient failures during embedding generation or database insertion.
    - **Security**: 
        - Ensure that sensitive information within `serialized_conversations` or `metadata` is handled securely, adhering to data protection regulations and best practices.
        - Validate and sanitize inputs to prevent potential injection attacks or data corruption.
</pre> 
</div>
</div>
<a id="a862a0f5f808ef8718cbd4e067a263beb" name="a862a0f5f808ef8718cbd4e067a263beb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a862a0f5f808ef8718cbd4e067a263beb">&#9670;&#160;</a></span>convert_metadata_value()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.convert_metadata_value </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>value</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Converts a metadata value to a JSON-serializable format suitable for storage.

This method processes the input `value` to ensure it is in a format that can be
stored within the vector database's metadata. The conversion rules are as follows:
- If the value is `None`, it returns an empty string.
- If the value is a list or dictionary, it serializes it to a JSON string.
- For all other data types, it returns the value unchanged.

Args:
    value (Any):
        The metadata value to be converted. This can be of any data type, including
        `None`, list, dictionary, string, integer, float, etc.

Returns:
    Union[str, Any]:
        - Returns an empty string if the input `value` is `None`.
        - Returns a JSON string if the input `value` is a list or dictionary.
        - Returns the original `value` unchanged for all other data types.

Raises:
    TypeError:
        If the input `value` is a type that cannot be serialized to JSON (when it's a list or dictionary).

Example:
    ```python
    # Example usage of convert_metadata_value

    # Case 1: Value is None
    converted = instance.convert_metadata_value(None)
    print(converted)  # Output: ""

    # Case 2: Value is a list
    converted = instance.convert_metadata_value([1, 2, 3])
    print(converted)  # Output: "[1, 2, 3]"

    # Case 3: Value is a dictionary
    converted = instance.convert_metadata_value({"key": "value"})
    print(converted)  # Output: "{"key": "value"}"

    # Case 4: Value is a string
    converted = instance.convert_metadata_value("sample text")
    print(converted)  # Output: "sample text"

    # Case 5: Value is an integer
    converted = instance.convert_metadata_value(42)
    print(converted)  # Output: 42
    ```

Notes:
    - This method is primarily used to ensure that metadata values are in a consistent and
    JSON-compatible format before being stored in the vector database.
    - When serializing lists or dictionaries, ensure that all nested elements are also JSON-serializable.
    - If the input `value` is a complex object that cannot be serialized to JSON, a `TypeError` will be raised.
    - It is advisable to handle or validate input values before passing them to this method to prevent unexpected errors.
    - The method does not modify the original input; it returns a new converted value based on the input.
</pre> 
</div>
</div>
<a id="a9ecebea5cbed0c54a33acb42a1999d27" name="a9ecebea5cbed0c54a33acb42a1999d27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9ecebea5cbed0c54a33acb42a1999d27">&#9670;&#160;</a></span>create_vector_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.create_vector_db </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>conversations</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Creates and initializes a vector database collection with the provided conversations.

This method performs the following steps:
1. Attempts to delete an existing collection named "conversations" to ensure a fresh start.
If the collection does not exist, it gracefully handles the `ValueError`.
2. Creates a new collection named "conversations" using the Chroma client.
3. Iterates through each conversation in the provided list, serializes it to JSON,
and adds it to the newly created vector database using the `add_to_vector_db` method.

Args:
    conversations (List[Dict[str, Any]]):
        A list of conversation dictionaries to be stored in the vector database.
        Each conversation dictionary should contain at least an "id" key and other relevant metadata.

Returns:
    None

Raises:
    None. All exceptions related to deleting the existing collection are handled internally.
    Any exceptions raised during the addition of entries to the vector database are handled
    by the `add_to_vector_db` method, which logs the errors.

Example:
    ```python
    conversations = [
        {
            "id": 1,
            "user_id": 101,
            "timestamp": "2025-01-19T12:00:00Z",
            "messages": [
                {"sender": "user", "text": "Hello"},
                {"sender": "bot", "text": "Hi there!"}
            ]
        },
        {
            "id": 2,
            "user_id": 102,
            "timestamp": "2025-01-19T12:05:00Z",
            "messages": [
                {"sender": "user", "text": "How are you?"},
                {"sender": "bot", "text": "I'm a bot, so I don't have feelings, but thanks for asking!"}
            ]
        }
    ]
    instance.create_vector_db(conversations)
    ```

Notes:
    - The method uses the `chroma_client` to interact with the Chroma vector database.
    Ensure that `chroma_client` is properly initialized and authenticated before calling this method.
    - The collection name is hardcoded as "conversations". If multiple collections are needed,
    consider modifying the method to accept the collection name as a parameter.
    - The `add_to_vector_db` method is responsible for generating embeddings and handling
    the addition of each conversation to the vector database. Ensure that this method
    is correctly implemented and accessible within the class.
    - Conversations are serialized to JSON strings before being added to the vector database.
    Ensure that all conversation dictionaries are JSON-serializable.
    - Deleting the existing "conversations" collection ensures that the vector database starts
    fresh each time `create_vector_db` is called. If persistent storage of previous data is needed,
    consider removing or modifying the deletion step.
</pre> 
</div>
</div>
<a id="a39e48d77a583ccef6a9842de2b038c4e" name="a39e48d77a583ccef6a9842de2b038c4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39e48d77a583ccef6a9842de2b038c4e">&#9670;&#160;</a></span>flatten_embedding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.flatten_embedding </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>embedding</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Flattens a nested embedding list into a single-level list if necessary.

This method checks whether the first element of the `embedding` is a list. If it is, the method
assumes that the entire `embedding` is a nested list and proceeds to flatten it into a single-level
list. If the `embedding` is already a single-level list, it is returned unchanged.

Args:
    embedding (List[Any]):
        A list representing the embedding. This can be either a single-level list of numerical
        values or a nested list (i.e., a list of lists) that needs to be flattened.

Returns:
    List[Any]:
        A single-level list containing all elements of the original `embedding`. If the input was
        already a single-level list, it is returned as-is. If it was a nested list, it is flattened
        into a single-level list.

Raises:
    IndexError:
        If the `embedding` list is empty, accessing `embedding[0]` will raise an `IndexError`.
        Ensure that the `embedding` is a non-empty list before calling this method.
    TypeError:
        If the elements within the `embedding` are not lists when the method expects a nested list,
        a `TypeError` may be raised during the flattening process.

Example:
    ```python
    # Example usage of flatten_embedding

    # Case 1: Nested embedding
    nested_embedding = [[0.1, 0.2, 0.3], [0.4, 0.5, 0.6]]
    flattened = instance.flatten_embedding(nested_embedding)
    print(flattened)  # Output: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6]

    # Case 2: Already flat embedding
    flat_embedding = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6]
    flattened = instance.flatten_embedding(flat_embedding)
    print(flattened)  # Output: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6]
    ```

Notes:
    - The method assumes that if the first element of `embedding` is a list, then all elements are lists.
    Ensure that the `embedding` follows this structure to avoid inconsistent flattening.
    - Flattening is performed using a list comprehension that iterates through each sublist and each item
    within those sublists. This approach ensures that the order of elements is preserved.
    - If the `embedding` contains elements that are not lists (when the first element is a list), a
    `TypeError` may occur during the flattening process. It is recommended to validate the structure
    of `embedding` before invoking this method.
    - The method does not modify the original `embedding` but returns a new flattened list if necessary.
    - To handle empty embeddings gracefully, consider adding a check for emptiness before attempting
    to access `embedding[0]`.
</pre> 
</div>
</div>
<a id="a20c0cb4766eadf468b69b730095c2053" name="a20c0cb4766eadf468b69b730095c2053"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20c0cb4766eadf468b69b730095c2053">&#9670;&#160;</a></span>generate_embeddings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.generate_embeddings </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>model</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>input_text</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>truncate</em></span><span class="paramdefsep"> = </span><span class="paramdefval">True</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Generate embeddings for the given input text using the specified model.

This function sends a POST request to the embedding API endpoint to generate
embeddings for the provided input text.

Parameters:
model (str): The name of the model to use for generating embeddings.
input_text (str): The text for which embeddings are to be generated.
truncate (bool, optional): Whether to truncate the input text. Defaults to True.

Returns:
dict or None: A dictionary containing the generated embeddings if successful,
              or None if there was an error or no embeddings were found in the response.

Raises:
requests.RequestException: If there's an error in making the API request.
</pre> 
</div>
</div>
<a id="a5e99eb967400dffb2292f302e2ee9d10" name="a5e99eb967400dffb2292f302e2ee9d10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e99eb967400dffb2292f302e2ee9d10">&#9670;&#160;</a></span>retrieve_embedding()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.retrieve_embedding </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>prompt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>n_results</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Retrieve embeddings for a given prompt and query the vector database.

This function generates embeddings for the input prompt, flattens them,
and then queries the vector database to find similar entries.

Parameters:
prompt (str): The input text for which to retrieve similar embeddings.
n_results (int, optional): The number of results to return from the query. Defaults to 1.

Returns:
dict or None: A dictionary containing the query results if successful,
              or None if there was an error in embedding generation or database querying.
</pre> 
</div>
</div>
<a id="ad13d2228589a87d3ab4c52ef133507b3" name="ad13d2228589a87d3ab4c52ef133507b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad13d2228589a87d3ab4c52ef133507b3">&#9670;&#160;</a></span>retrieve_embedding_vision()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.retrieve_embedding_vision </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>prompt</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>n_results</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Retrieve embeddings for a given prompt and query the vector database.

This function generates embeddings for the input prompt, flattens them,
and then queries the vector database to find similar entries.

Parameters:
prompt (str): The input text for which to retrieve similar embeddings.
n_results (int, optional): The number of results to return from the query. Defaults to 1.

Returns:
dict or None: A dictionary containing the query results if successful,
              or None if there was an error in embedding generation or database querying.
</pre> 
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="abd453000e0c3c3079b7b6b7e50a5d711" name="abd453000e0c3c3079b7b6b7e50a5d711"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd453000e0c3c3079b7b6b7e50a5d711">&#9670;&#160;</a></span>base_url</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">str equator_qa.vectordb.VectorDB_Controller.base_url = &quot;http://localhost:11434&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3bb137ff4503408f32c64ee39dfbfd16" name="a3bb137ff4503408f32c64ee39dfbfd16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3bb137ff4503408f32c64ee39dfbfd16">&#9670;&#160;</a></span>chroma_client</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.chroma_client = chromadb.PersistentClient(path=&quot;.&quot;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a445fe5029b1ab0bf0e7c31921ea5f7f1" name="a445fe5029b1ab0bf0e7c31921ea5f7f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a445fe5029b1ab0bf0e7c31921ea5f7f1">&#9670;&#160;</a></span>keepVectorDB</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">equator_qa.vectordb.VectorDB_Controller.keepVectorDB = keepVectorDB</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="vectordb_8py.html">vectordb.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceequator__qa.html">equator_qa</a></li><li class="navelem"><a class="el" href="namespaceequator__qa_1_1vectordb.html">vectordb</a></li><li class="navelem"><a class="el" href="classequator__qa_1_1vectordb_1_1_vector_d_b___controller.html">VectorDB_Controller</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
